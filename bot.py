# -*- coding: utf-8 -*-
import os
import logging
import asyncio
from collections import defaultdict
from aiogram import Bot, Dispatcher, executor, types
from aiogram.types import ReplyKeyboardMarkup

# ‚îÄ‚îÄ –í–°–¢–ê–í–¨ –¢–û–ö–ï–ù –ó–î–ï–°–¨ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# –¢–æ–∫–µ–Ω –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (Replit Secrets)
API_TOKEN = os.getenv("API_TOKEN", "").strip()

if not API_TOKEN:
    raise RuntimeError(
        "–ù–µ –Ω–∞–π–¥–µ–Ω API_TOKEN. –î–æ–±–∞–≤—å –µ–≥–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –≤–ø–∏—à–∏ –≤ –∫–æ–¥."
    )

# ‚îÄ‚îÄ –õ–û–ì–ò/–ë–û–¢ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
logging.basicConfig(level=logging.INFO)
bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

# ‚îÄ‚îÄ 6 –ú–ï–î-–ê–†–•–ï–¢–ò–ü–û–í ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
TYPES = [
    "–®–∏–∑–æ–∏–¥", "–ü—Å–∏—Ö–∞—Å—Ç–µ–Ω–∏–∫", "–≠–ø–∏–ª–µ–ø—Ç–æ–∏–¥", "–ò—Å—Ç–µ—Ä–æ–∏–¥", "–ù–µ–≤—Ä–∞—Å—Ç–µ–Ω–∏–∫",
    "–î–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π"
]

PROFILE = {
    "–®–∏–∑–æ–∏–¥": {
        "alias":
        "–ê—Ä—Ö–µ—Ç–∏–ø –ú—É–¥—Ä–µ—Ü–∞",
        "desc":
        "–ß–µ–ª–æ–≤–µ–∫ —Å–º—ã—Å–ª–∞ –∏ —Ç–∏—à–∏–Ω—ã. –ü—Ä–∏ —Å—Ç—Ä–µ—Å—Å–µ —É—Ö–æ–¥–∏—Ç –≤ –º—ã—Å–ª–∏, —Ç–µ–ª–æ ¬´–æ—Ç–∫–ª—é—á–∞–µ—Ç¬ª.",
        "nervous":
        "–î–æ–º–∏–Ω–∏—Ä—É–µ—Ç –Ω–µ–æ–∫–æ—Ä—Ç–µ–∫—Å, —Å–ª–∞–±–∞—è —Å–≤—è–∑—å —Å —Ç–µ–ª–æ–º.",
        "soma":
        "–®–µ—è/–ø–ª–µ—á–∏, –≥–ª–∞–∑–∞, –≥–æ–ª–æ–≤–∞; —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –±–µ—Å—Å–æ–Ω–Ω–∏—Ü–µ.",
        "hygiene":
        "–°–µ–Ω—Å–æ—Ä–Ω–æ–µ –∑–∞–∑–µ–º–ª–µ–Ω–∏–µ, –º–µ–¥–ª–µ–Ω–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ, –ø–∞—É–∑—ã –±–µ–∑ —ç–∫—Ä–∞–Ω–∞, —Ç—ë–ø–ª—ã–π –¥—É—à.",
        "triggers":
        "–®—É–º, –¥–∞–≤–ª–µ–Ω–∏–µ, –≤—Ç–æ—Ä–∂–µ–Ω–∏–µ –≤ –ª–∏—á–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã.",
        "recovery":
        "–¢–∏—à–∏–Ω–∞, –ø—Ä–æ–≥—É–ª–∫–∞, —Ä–∏—Ç—É–∞–ª—ã (—á–∞–π, —Å–≤–µ—á–∞), —Ñ–æ–∫—É—Å ¬´—á—É–≤—Å—Ç–≤—É—é —Ç–µ–ª–æ¬ª.",
        "partner":
        "–¢—ë–ø–ª–∞—è —Ç–µ–ª–µ—Å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è (–≥–µ–¥–æ–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª—é—Å) ‚Äî —É—á–∏—Ç —Ä–∞—Å—Å–ª–∞–±–ª—è—Ç—å—Å—è –∏ —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è."
    },
    "–ü—Å–∏—Ö–∞—Å—Ç–µ–Ω–∏–∫": {
        "alias": "–ê—Ä—Ö–µ—Ç–∏–ø –ò—Å–∫–∞—Ç–µ–ª—è",
        "desc":
        "–¢–æ–Ω–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å. –ò—â–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —è—Å–Ω–æ—Å—Ç—å.",
        "nervous": "–õ–µ–≥–∫–æ –ø–µ—Ä–µ–≤–æ–∑–±—É–∂–¥–∞–µ—Ç—Å—è –æ—Ç –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏.",
        "soma": "–î–∏–∞—Ñ—Ä–∞–≥–º–∞/–ñ–ö–¢, –¥—ã—Ö–∞–Ω–∏–µ, —Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏–µ.",
        "hygiene":
        "–î—ã—Ö–∞–Ω–∏–µ 4‚Äì6, –ø–ª–∞–Ω –Ω–∞ –¥–µ–Ω—å, –¥–Ω–µ–≤–Ω–∏–∫ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏, —Ç—ë–ø–ª–∞—è –µ–¥–∞.",
        "triggers": "–†–µ–∑–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω—ã, –∫—Ä–∏—Ç–∏–∫–∞, —Ö–∞–æ—Å –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏.",
        "recovery":
        "–°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–∏—Ç—É–∞–ª—ã, –æ–ø–æ—Ä–∞ –Ω–∞ –æ—â—É—â–µ–Ω–∏—è —Ç–µ–ª–∞, –º—è–≥–∫–∏–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –¥–∏–∞–ª–æ–≥.",
        "partner": "–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–ª—é—Å (–í–æ–∏–Ω/–≠–ø–∏–ª–µ–ø—Ç–æ–∏–¥) ‚Äî –¥–∞—ë—Ç –æ–ø–æ—Ä—É –∏ —Ñ–æ—Ä–º—É."
    },
    "–≠–ø–∏–ª–µ–ø—Ç–æ–∏–¥": {
        "alias":
        "–ê—Ä—Ö–µ—Ç–∏–ø –í–æ–∏–Ω–∞",
        "desc":
        "–°–∏–ª–∞, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ–Ω—Ç—Ä–æ–ª—å. –¢–µ–ª—É –Ω—É–∂–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏.",
        "nervous":
        "–°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –º–æ–±–∏–ª–∏–∑–∞—Ü–∏–∏, –≤—ã—Å–æ–∫–∏–π —Ç–æ–Ω—É—Å.",
        "soma":
        "–°–ø–∞–∑–º—ã, —á–µ–ª—é—Å—Ç–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏—è, –≥–æ–ª–æ–≤–Ω—ã–µ –±–æ–ª–∏.",
        "hygiene":
        "–§–∏–∑–∏—á–µ—Å–∫–∞—è —Ä–∞–∑—Ä—è–¥–∫–∞, —Ä–∞—Å—Ç—è–∂–∫–∞, –¥–ª–∏–Ω–Ω—ã–π –≤—ã–¥–æ—Ö —á–µ—Ä–µ–∑ —Ä–æ—Ç, –º–∞—Å—Å–∞–∂ —à–µ–∏/–ø–ª–µ—á.",
        "triggers":
        "–•–∞–æ—Å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª, –ø–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å –æ–∫—Ä—É–∂–∞—é—â–∏—Ö.",
        "recovery":
        "–ü–æ—Ä—è–¥–æ–∫, —á—ë—Ç–∫–∏–µ –∑–∞–¥–∞—á–∏, —Å–ø–æ—Ä—Ç, –¥—ã—Ö–∞–Ω–∏–µ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –≤—ã–¥–æ—Ö.",
        "partner":
        "–¢—ë–ø–ª—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –ø–æ–ª—é—Å (–ó–∞–±–æ—Ç–ª–∏–≤—ã–π/–î–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π) ‚Äî —Å–º—è–≥—á–∞–µ—Ç –∏ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç."
    },
    "–ò—Å—Ç–µ—Ä–æ–∏–¥": {
        "alias": "–ê—Ä—Ö–µ—Ç–∏–ø –¢–≤–æ—Ä—Ü–∞",
        "desc":
        "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –±—ã—Ç—å —É–≤–∏–¥–µ–Ω–Ω—ã–º. –ò—Å—Ç–æ—á–Ω–∏–∫ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è.",
        "nervous": "–õ–∏–º–±–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞, —ç–º–æ—Ü–∏–∏ –±—ã—Å—Ç—Ä–æ –≤—Å–ø—ã—Ö–∏–≤–∞—é—Ç.",
        "soma": "–ö–æ–∂–∞, –≥–æ—Ä–ª–æ/–¥—ã—Ö–∞–Ω–∏–µ; –ø—Å–∏—Ö–æ—Ñ–∏–∑–∏–æ–ª–æ–≥–∏—è –≥–æ–ª–æ—Å–∞ –∏ —Å—Ü–µ–Ω—ã.",
        "hygiene":
        "–î–Ω–µ–≤–Ω–∏–∫ —ç–º–æ—Ü–∏–π, ¬´–¥—ã—Ö–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–µ—Ä–¥—Ü–µ¬ª, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤, –ø—Ä–∞–∫—Ç–∏–∫–∞ —Å–∞–º–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏.",
        "triggers": "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ö–æ–ª–æ–¥–Ω–æ—Å—Ç—å, –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç—å.",
        "recovery": "–°–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∑—Ä–∏—Ç–µ–ª–µ–º/–¥—Ä—É–≥–æ–º.",
        "partner": "–ú—É–¥—Ä–µ—Ü/–®–∏–∑–æ–∏–¥ ‚Äî –¥–∞—ë—Ç –≥–ª—É–±–∏–Ω—É –∏ –∑–∞–∑–µ–º–ª—è–µ—Ç –∫ –ø—Ä–æ—Ü–µ—Å—Å—É."
    },
    "–ù–µ–≤—Ä–∞—Å—Ç–µ–Ω–∏–∫": {
        "alias":
        "–ê—Ä—Ö–µ—Ç–∏–ø –õ–∏–¥–µ—Ä–∞",
        "desc":
        "–í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –∏—Å—Ç–æ—â–∞–µ–º–æ—Å—Ç—å. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç ‚Äî —Ä–∏—Å–∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—è.",
        "nervous":
        "–ö–æ–ª–µ–±–∞–Ω–∏—è —Ç–æ–Ω—É—Å–∞, —Ä–µ—Å—É—Ä—Å –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–º–µ—Ç–Ω–æ.",
        "soma":
        "–°–µ—Ä–¥—Ü–µ/—Å–æ—Å—É–¥—ã, —Å–ª–∞–±–æ—Å—Ç—å, –º—ã—à–µ—á–Ω—ã–π —Ç–æ–Ω—É—Å.",
        "hygiene":
        "–†–µ–∂–∏–º —Å–Ω–∞, –ø—Ä–æ–≥—É–ª–∫–∏ –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –æ—Ç–∫–∞–∑ –æ—Ç –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏, —É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–∞—Å—Ç—è–∂–∫–∏.",
        "triggers":
        "–ü–µ—Ä–µ—É—Ç–æ–º–ª–µ–Ω–∏–µ, —Å–≤–µ—Ä—Ö–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å.",
        "recovery":
        "–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –ø–∞—É–∑—ã, –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥—ã—Ö–∞–Ω–∏–µ 4‚Äì6.",
        "partner":
        "–£—Å—Ç–æ–π—á–∏–≤—ã–π ¬´–≤–æ–∏–Ω—Å–∫–∏–π¬ª –ø–æ–ª—é—Å (–≠–ø–∏–ª–µ–ø—Ç–æ–∏–¥) ‚Äî –ø–æ–º–æ–≥–∞–µ—Ç –¥–æ–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É."
    },
    "–î–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π": {
        "alias":
        "–ê—Ä—Ö–µ—Ç–∏–ø –ó–∞–±–æ—Ç–ª–∏–≤–æ–≥–æ",
        "desc":
        "–ì–ª—É–±–æ–∫–∞—è —ç–º–ø–∞—Ç–∏—è –∏ —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∑–∞–±—ã–≤–∞—Ç—å –æ —Å–µ–±–µ. –¢–µ–ª—É –Ω—É–∂–Ω–∞ –º—è–≥–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è.",
        "nervous":
        "–°–Ω–∏–∂–µ–Ω–∏–µ —Ç–æ–Ω—É—Å–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–µ —ç–º–æ—Ü–∏—è–º–∏.",
        "soma":
        "–°–ø–∏–Ω–∞/–≥—Ä—É–¥—å, –∂–µ–ª—É–¥–æ–∫, —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –Ω–∏–∑–∫–æ–º—É –¥–∞–≤–ª–µ–Ω–∏—é.",
        "hygiene":
        "–¢–µ–ø–ª–æ, –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞ –≤—ã–¥–æ—Ö, ¬´–∑–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ¬ª –∫–∞–∫ —Ä–∏—Ç—É–∞–ª, –º—è–≥–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞.",
        "triggers":
        "–í–∏–Ω–∞, –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ, –ø–µ—Ä–µ–∏–∑–±—ã—Ç–æ–∫ –∑–∞–±–æ—Ç—ã –æ –¥—Ä—É–≥–∏—Ö.",
        "recovery":
        "–û–±—ä—è—Ç–∏—è, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π, –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –∏ –æ—Ç–¥—ã—Ö.",
        "partner":
        "–°–æ–±—Ä–∞–Ω–Ω—ã–π –ª–∏–¥–µ—Ä—Å–∫–∏–π –ø–æ–ª—é—Å (–ù–µ–≤—Ä–∞—Å—Ç–µ–Ω–∏–∫) ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏–µ –∏ —è—Å–Ω–æ—Å—Ç—å."
    },
}

LETTER2TYPE = {
    "A": "–®–∏–∑–æ–∏–¥",
    "B": "–ü—Å–∏—Ö–∞—Å—Ç–µ–Ω–∏–∫",
    "C": "–≠–ø–∏–ª–µ–ø—Ç–æ–∏–¥",
    "D": "–ò—Å—Ç–µ—Ä–æ–∏–¥",
    "E": "–ù–µ–≤—Ä–∞—Å—Ç–µ–Ω–∏–∫",
    "F": "–î–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π",
}

# ‚îÄ‚îÄ 12 –ö–û–†–û–¢–ö–ò–• –í–û–ü–†–û–°–û–í ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
QUESTIONS = [
    "1. –ö–æ–≥–¥–∞ –Ω–∞–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å, –ø–µ—Ä–≤–∏—á–Ω–æ –≤–∫–ª—é—á–∞–µ—Ç—Å—è‚Ä¶\nA) –º—ã—Å–ª–∏\nB) —Ç—Ä–µ–≤–æ–≥–∞\nC) –¥–µ–π—Å—Ç–≤–∏–µ\nD) —ç–º–æ—Ü–∏–∏\nE) –∫–æ–Ω—Ç—Ä–æ–ª—å/–∑–∞–¥–∞—á–∞\nF) –∑–∞–±–æ—Ç–∞ –æ –¥—Ä—É–≥–∏—Ö",
    "2. –í —Ç–µ–ª–µ —á–∞—â–µ –≤—Å–µ–≥–æ –æ—â—É—â–∞—é‚Ä¶\nA) –≥–æ–ª–æ–≤—É/–≥–ª–∞–∑–∞/—à–µ—é\nB) –¥–∏–∞—Ñ—Ä–∞–≥–º—É/–∂–∏–≤–æ—Ç\nC) —Å–ø–∞–∑–º/—á–µ–ª—é—Å—Ç—å/–ø–ª–µ—á–∏\nD) –≥–æ—Ä–ª–æ/–¥—ã—Ö–∞–Ω–∏–µ/–∫–æ–∂—É\nE) —Å–µ—Ä–¥—Ü–µ/—É—Å—Ç–∞–ª–æ—Å—Ç—å\nF) —Ç—è–∂–µ—Å—Ç—å –≤ —Å–ø–∏–Ω–µ/–≥—Ä—É–¥–∏",
    "3. –ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –Ω–µ–≤—ã–Ω–æ—Å–∏–º–æ‚Ä¶\nA) –ø—É—Å—Ç—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã\nB) –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å\nC) —Ö–∞–æ—Å –∏ –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª\nD) –∫–æ–≥–¥–∞ –º–µ–Ω—è –Ω–µ –≤–∏–¥—è—Ç\nE) –Ω–µ—Å–∫–æ–Ω—á–∞–µ–º—ã–µ –∑–∞–¥–∞—á–∏\nF) –±—ã—Ç—å –Ω—É–∂–Ω—ã–º –≤—Å–µ–º –≤—Å–µ–≥–¥–∞",
    "4. –ë—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Å—å —á–µ—Ä–µ–∑‚Ä¶\nA) —Ç–∏—à–∏–Ω—É/–æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ\nB) —Ä–∏—Ç—É–∞–ª—ã/–ø–ª–∞–Ω\nC) —Å–ø–æ—Ä—Ç/—Ä–∞–∑—Ä—è–¥–∫—É\nD) —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ/—Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ\nE) –ø—Ä–æ–≥—É–ª–∫—É/—Å–æ–Ω\nF) —Ç–µ–ø–ª–æ/–æ–±—ä—è—Ç–∏—è",
    "5. –í –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö —è –æ–±—ã—á–Ω–æ‚Ä¶\nA) —É—Ö–æ–∂—É –≤ –∞–Ω–∞–ª–∏–∑\nB) —Ç—Ä–µ–≤–æ–∂—É—Å—å –∏ –ø—Ä–æ–≤–µ—Ä—è—é\nC) –∏–¥—É –≤ –ª–æ–±\nD) —Ä–µ–∞–≥–∏—Ä—É—é —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ\nE) –±–µ—Ä—É –∫–æ–Ω—Ç—Ä–æ–ª—å\nF) —Å–≥–ª–∞–∂–∏–≤–∞—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é",
    "6. –ò–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å ‚Äî —ç—Ç–æ‚Ä¶\nA) –∫–Ω–∏–≥–∞ –∏ —Ç–∏—à–∏–Ω–∞\nB) –ø–æ—Ä—è–¥–æ–∫ –∏ –ø–ª–∞–Ω—ã\nC) –¥–≤–∏–∂–µ–Ω–∏–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç\nD) —Å—Ü–µ–Ω–∞/—Å—Ç—É–¥–∏—è/–∫—Ä–µ–∞—Ç–∏–≤\nE) —Ü–µ–ª—å/–∫–æ–º–∞–Ω–¥–∞\nF) –¥–æ–º/—É—é—Ç/—Ç–µ–ø–ª–æ",
    "7. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ü–µ–ª—å –±–ª–∏–∂–µ‚Ä¶\nA) –ø–æ–Ω—è—Ç—å —Å—É—Ç—å\nB) —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\nC) —Å–¥–µ–ª–∞—Ç—å –∏ –ø–æ–±–µ–¥–∏—Ç—å\nD) –±—ã—Ç—å —É–≤–∏–¥–µ–Ω–Ω—ã–º/–≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å\nE) –≤–µ—Å—Ç–∏ –∏ –≤–ª–∏—è—Ç—å\nF) –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –∏ —Å–æ–µ–¥–∏–Ω—è—Ç—å",
    "8. –í —Ç–µ–ª–µ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç‚Ä¶\nA) —Å–µ–Ω—Å–æ—Ä–Ω–æ–µ –∑–∞–∑–µ–º–ª–µ–Ω–∏–µ\nB) –¥—ã—Ö–∞–Ω–∏–µ 4‚Äì6\nC) —Ä–∞—Å—Ç—è–∂–∫–∞ + –≤—ã–¥–æ—Ö —á–µ—Ä–µ–∑ —Ä–æ—Ç\nD) ¬´–¥—ã—Ö–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–µ—Ä–¥—Ü–µ¬ª\nE) —É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–∞—Å—Ç—è–∂–∫–∏/—Ö–æ–¥—å–±–∞\nF) —Ç—ë–ø–ª—ã–µ –≤–∞–Ω–Ω—ã/–º—è–≥–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞",
    "9. –í —Ä–∞–±–æ—Ç–µ –≤–∞–∂–Ω–µ–µ‚Ä¶\nA) —Å–º—ã—Å–ª\nB) —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å\nC) –ø–æ—Ä—è–¥–æ–∫/—Å—Ç—Ä—É–∫—Ç—É—Ä–∞\nD) –∫—Ä–µ–∞—Ç–∏–≤\nE) —Ä–µ–∑—É–ª—å—Ç–∞—Ç/–≤–ª–∏—è–Ω–∏–µ\nF) –ø–æ–ª—å–∑–∞ –ª—é–¥—è–º",
    "10. –õ—É—á—à–∞—è —Ñ—Ä–∞–∑–∞-–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ–π—á–∞—Å‚Ä¶\nA) ¬´–ß—É–≤—Å—Ç–≤—É—é —Ç–µ–ª–æ, –Ω–µ —Ç–æ–ª—å–∫–æ –º—ã—Å–ª–∏¬ª\nB) ¬´–£ –º–µ–Ω—è –µ—Å—Ç—å –æ–ø–æ—Ä—ã¬ª\nC) ¬´–°–∏–ª–∞ ‚Äî –≤ –¥–µ–π—Å—Ç–≤–∏–∏ –∏ –≤—ã–¥–æ—Ö–µ¬ª\nD) ¬´–Ø —Ü–µ–Ω–µ–Ω(–∞), –¥–∞–∂–µ –∫–æ–≥–¥–∞ –º–µ–Ω—è –Ω–µ –≤–∏–¥—è—Ç¬ª\nE) ¬´–Ø –º–æ–≥—É –º–µ–Ω—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å¬ª\nF) ¬´–Ø —Ç–æ–∂–µ –≤–∞–∂–µ–Ω(–Ω–∞) –¥–ª—è —Å–µ–±—è¬ª",
    "11. –í –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö –∏—â—É –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ‚Ä¶\nA) –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ\nB) –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å\nC) —á–µ—Å—Ç–Ω–æ—Å—Ç—å –∏ —Ä–∞–º–∫–∏\nD) –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –æ—Ç–∫–ª–∏–∫\nE) –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ –∏ —Ü–µ–ª–∏\nF) —Ç–µ–ø–ª–æ –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ",
    "12. –ö–æ–≥–¥–∞ —É—Å—Ç–∞—é, –º–Ω–µ –≤—Ä–µ–¥–Ω–µ–µ –≤—Å–µ–≥–æ‚Ä¶\nA) –ø–µ—Ä–µ–≥—Ä—É–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π\nB) –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–ª–∞–Ω–∞\nC) —Å–∏–¥—è—á–µ–µ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–µ\nD) –º–æ–ª—á–∞–ª–∏–≤–æ–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ\nE) –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏\nF) –∑–∞–±—ã—Ç—å –æ —Å–µ–±–µ —Ä–∞–¥–∏ –¥—Ä—É–≥–∏—Ö",
]

# ‚îÄ‚îÄ –°–û–°–¢–û–Ø–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
users = defaultdict(
    lambda: {
        "step": 0,
        "scores": defaultdict(int),
        "finished": False,
        "result": None,
        "daily": False,
    })


def kb_answers():
    kb = ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
    kb.row("A", "B", "C")
    kb.row("D", "E", "F")
    return kb


def kb_post_result():
    kb = ReplyKeyboardMarkup(resize_keyboard=True)
    kb.row("‚ú® –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ", "üíû –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π –∞—Ä—Ö–µ—Ç–∏–ø")
    kb.row("üåø –ü—Å–∏—Ö–æ–≥–∏–≥–∏–µ–Ω–∞", "üîÅ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ")
    return kb


# ‚îÄ‚îÄ –•–≠–ù–î–õ–ï–†–´ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
@dp.message_handler(commands=["start", "restart"])
async def cmd_start(msg: types.Message):
    uid = msg.from_user.id
    users[uid] = {
        "step": 0,
        "scores": defaultdict(int),
        "finished": False,
        "result": None,
        "daily": False
    }
    await msg.answer(
        "–ü—Ä–∏–≤–µ—Ç üåø –≠—Ç–æ SoulMap MED.\n"
        "12 –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–º–æ–≥—É—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–≤–æ–π –ø—Å–∏—Ö–æ—Ç–∏–ø –∏ –¥–∞—Ç—å —Ç–µ–ª–µ—Å–Ω–æ-–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.\n\n"
        + QUESTIONS[0],
        reply_markup=kb_answers())


@dp.message_handler(lambda m: m.text == "üîÅ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ")
async def restart(msg: types.Message):
    await cmd_start(msg)


@dp.message_handler(lambda m: m.text and m.text.upper() in "ABCDEF")
async def handle_answer(msg: types.Message):
    uid = msg.from_user.id
    if users[uid]["finished"]:
        await msg.answer(
            "–¢–µ—Å—Ç —É–∂–µ –∑–∞–≤–µ—Ä—à—ë–Ω. –ù–∞–∂–º–∏ ¬´üîÅ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ¬ª, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞.",
            reply_markup=kb_post_result())
        return

    letter = msg.text.upper()
    t = LETTER2TYPE[letter]
    users[uid]["scores"][t] += 1
    users[uid]["step"] += 1

    step = users[uid]["step"]
    if step < len(QUESTIONS):
        await msg.answer(QUESTIONS[step], reply_markup=kb_answers())
    else:
        # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        scores = users[uid]["scores"]
        primary = max(scores, key=scores.get)
        # –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π
        second = None
        if len(scores) > 1:
            second = sorted(scores.items(), key=lambda x: x[1],
                            reverse=True)[1][0]

        users[uid]["finished"] = True
        users[uid]["result"] = primary
        p = PROFILE[primary]

        await msg.answer("‚ú® –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã‚Ä¶")
        await asyncio.sleep(0.7)

        text = (f"‚ú® –¢–≤–æ–π –ø—Å–∏—Ö–æ—Ç–∏–ø: *{primary}* ({p['alias']})\n\n"
                f"_–û —Ç–µ–±–µ_: {p['desc']}\n\n"
                f"‚öïÔ∏è *–ù–µ—Ä–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞*: {p['nervous']}\n"
                f"ü´Ä *–ü—Å–∏—Ö–æ—Å–æ–º–∞—Ç–∏–∫–∞*: {p['soma']}\n\n"
                f"üåø *–ü—Å–∏—Ö–æ–≥–∏–≥–∏–µ–Ω–∞*: {p['hygiene']}\n\n"
                f"üí´ *–¢—Ä–∏–≥–≥–µ—Ä—ã*: {p['triggers']}\n"
                f"üß© *–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ*: {p['recovery']}\n\n"
                f"üíû *–ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π –∞—Ä—Ö–µ—Ç–∏–ø*: {p['partner']}\n" +
                (f"\n_–í—Ç–æ—Ä–æ–π –ø–æ —Å–∏–ª–µ_: {second}" if second else ""))
        await msg.answer(text,
                         parse_mode="Markdown",
                         reply_markup=kb_post_result())


@dp.message_handler(
    lambda m: m.text in
    ["‚ú® –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ", "üíû –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π –∞—Ä—Ö–µ—Ç–∏–ø", "üåø –ü—Å–∏—Ö–æ–≥–∏–≥–∏–µ–Ω–∞"])
async def post_menu(msg: types.Message):
    uid = msg.from_user.id
    if not users[uid]["finished"]:
        await msg.answer("–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–π–¥–∏ —Ç–µ—Å—Ç: /start")
        return
    arch = users[uid]["result"]
    p = PROFILE[arch]

    if msg.text == "‚ú® –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ":
        await msg.answer(
            f"–ì–ª—É–±–∂–µ –ø—Ä–æ *{arch}* ({p['alias']}):\n"
            f"‚Äî –õ—É—á—à–µ –≤—Å–µ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—à—å—Å—è —á–µ—Ä–µ–∑: {p['recovery']}\n"
            f"‚Äî –ü–æ–º–Ω–∏ –æ —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö: {p['triggers']}\n"
            f"‚Äî –ö–ª—é—á–µ–≤–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞: {p['hygiene']}",
            parse_mode="Markdown",
            reply_markup=kb_post_result())
    elif msg.text == "üíû –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π –∞—Ä—Ö–µ—Ç–∏–ø":
        await msg.answer(f"üíû –¢–µ–±—è —É—Ä–∞–≤–Ω–æ–≤–µ—à–∏–≤–∞–µ—Ç: {p['partner']}",
                         reply_markup=kb_post_result())
    elif msg.text == "üåø –ü—Å–∏—Ö–æ–≥–∏–≥–∏–µ–Ω–∞":
        await msg.answer(f"üåø –ü—Å–∏—Ö–æ–≥–∏–≥–∏–µ–Ω–∞ –¥–ª—è *{arch}*:\n{p['hygiene']}",
                         parse_mode="Markdown",
                         reply_markup=kb_post_result())


@dp.message_handler()
async def fallback(msg: types.Message):
    uid = msg.from_user.id
    if not users[uid]["finished"]:
        step = users[uid]["step"]
        if step < len(QUESTIONS):
            await msg.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—á–∞–π –±—É–∫–≤–∞–º–∏ A‚ÄìF üòä\n\n" +
                             QUESTIONS[step],
                             reply_markup=kb_answers())
        else:
            await msg.answer("–ù–∞–∂–º–∏ /start —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.")
    else:
        await msg.answer("–í—ã–±–µ—Ä–∏ –ø—É–Ω–∫—Ç –≤ –º–µ–Ω—é –Ω–∏–∂–µ üëá",
                         reply_markup=kb_post_result())


if __name__ == "__main__":
    print("‚úÖ SoulMap MED ‚Ä¢ –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–ø—É—â–µ–Ω–∞")
    executor.start_polling(dp, skip_updates=True)
